!function(){"use strict";function t(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);if(204!==t.status&&205!==t.status)return t.json()}function n(){}function e(t){return t()}function o(){return Object.create(null)}function r(t){t.forEach(e)}function i(t){return"function"==typeof t}function l(t,n){return t!=t?n==n:t!==n||t&&"object"==typeof t||"function"==typeof t}function c(t,n){t.appendChild(n)}function s(t,n,e){t.insertBefore(n,e||null)}function a(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function f(t){return document.createTextNode(t)}function d(){return f(" ")}function m(t,n,e,o){return t.addEventListener(n,e,o),()=>t.removeEventListener(n,e,o)}function p(t,n,e){null==e?t.removeAttribute(n):t.getAttribute(n)!==e&&t.setAttribute(n,e)}function g(t,n){t.value=null==n?"":n}let h;function b(t){h=t}function $(){const t=function(){if(!h)throw new Error("Function called outside component initialization");return h}();return(n,e)=>{const o=t.$$.callbacks[n];if(o){const r=function(t,n){const e=document.createEvent("CustomEvent");return e.initCustomEvent(t,!1,!1,n),e}(n,e);o.slice().forEach(n=>{n.call(t,r)})}}}const v=[],_=[],y=[],w=[],x=Promise.resolve();let E=!1;function k(t){y.push(t)}let C=!1;const A=new Set;function S(){if(!C){C=!0;do{for(let t=0;t<v.length;t+=1){const n=v[t];b(n),T(n.$$)}for(b(null),v.length=0;_.length;)_.pop()();for(let t=0;t<y.length;t+=1){const n=y[t];A.has(n)||(A.add(n),n())}y.length=0}while(v.length);for(;w.length;)w.pop()();E=!1,C=!1,A.clear()}}function T(t){if(null!==t.fragment){t.update(),r(t.before_update);const n=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,n),t.after_update.forEach(k)}}const N=new Set;function O(t,n){-1===t.$$.dirty[0]&&(v.push(t),E||(E=!0,x.then(S)),t.$$.dirty.fill(0)),t.$$.dirty[n/31|0]|=1<<n%31}function M(t,l,c,s,u,f,d=[-1]){const m=h;b(t);const p=t.$$={fragment:null,ctx:null,props:f,update:n,not_equal:u,bound:o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(m?m.$$.context:[]),callbacks:o(),dirty:d,skip_bound:!1};let g=!1;if(p.ctx=c?c(t,l.props||{},(n,e,...o)=>{const r=o.length?o[0]:e;return p.ctx&&u(p.ctx[n],p.ctx[n]=r)&&(!p.skip_bound&&p.bound[n]&&p.bound[n](r),g&&O(t,n)),e}):[],p.update(),g=!0,r(p.before_update),p.fragment=!!s&&s(p.ctx),l.target){if(l.hydrate){const t=function(t){return Array.from(t.childNodes)}(l.target);p.fragment&&p.fragment.l(t),t.forEach(a)}else p.fragment&&p.fragment.c();l.intro&&(($=t.$$.fragment)&&$.i&&(N.delete($),$.i(v))),function(t,n,o,l){const{fragment:c,on_mount:s,on_destroy:a,after_update:u}=t.$$;c&&c.m(n,o),l||k(()=>{const n=s.map(e).filter(i);a?a.push(...n):r(n),t.$$.on_mount=[]}),u.forEach(k)}(t,l.target,l.anchor,l.customElement),S()}var $,v;b(m)}function j(t){let n,e,o=t[0].emails[0]+"";return{c(){n=u("strong"),e=f(o),p(n,"class","rf-fi-account-fill rf-btn--icon-left")},m(t,o){s(t,n,o),c(n,e)},p(t,n){1&n&&o!==(o=t[0].emails[0]+"")&&function(t,n){n=""+n,t.wholeText!==n&&(t.data=n)}(e,o)},d(t){t&&a(n)}}}function F(t){let e;return{c(){e=u("button"),e.textContent="Se connecter",p(e,"class","rf-btn rf-fi-account-fill rf-btn--icon-left"),p(e,"aria-expanded","false"),p(e,"aria-controls","rf-modal-login")},m(t,n){s(t,e,n)},p:n,d(t){t&&a(e)}}}function L(t){let e,o,i,l,f,h,b,$,v,_,y,w,x,E,k,C,A,S,T;function N(t,n){return void 0===t[0]?F:j}let O=N(t),M=O(t);return{c(){M.c(),e=d(),o=u("dialog"),i=u("div"),l=u("div"),f=u("div"),h=u("div"),b=u("form"),$=u("div"),$.innerHTML='<button type="button" class="rf-link--close rf-link svelte-14wsiwu" title="Fermer la fenÃªtre modale" aria-controls="rf-modal-login" target="_self">Fermer</button>',v=d(),_=u("div"),y=u("h1"),y.textContent="Se connecter",w=d(),x=u("label"),x.textContent="Email",E=d(),k=u("input"),C=d(),A=u("div"),A.innerHTML='<ul class="rf-btns-group rf-btns-group--inline-lg rf-btns-group--icon-left"><li><button type="submit" class="rf-btn svelte-14wsiwu">Connexion</button></li></ul>',p($,"class","rf-modal__header"),p(y,"id","rf-modal-title-modal-2"),p(y,"class","rf-modal__title"),p(x,"class","rf-label"),p(x,"for","text-input-text"),p(k,"class","rf-input"),p(k,"type","email"),p(k,"placeholder","perrine@commune.fr"),p(k,"autocomplete","email"),p(k,"name","urbanvitaliz-email"),p(_,"class","rf-modal__content svelte-14wsiwu"),p(A,"class","rf-modal__footer"),p(h,"class","rf-modal__body"),p(f,"class","rf-col-12 rf-col-md-6"),p(l,"class","rf-grid-row rf-grid-row--center"),p(i,"class","rf-container--fluid rf-container-md"),p(o,"aria-labelledby","rf-modal-title-modal-2"),p(o,"role","dialog"),p(o,"id","rf-modal-login"),p(o,"class","rf-modal svelte-14wsiwu")},m(n,r){M.m(n,r),s(n,e,r),s(n,o,r),c(o,i),c(i,l),c(l,f),c(f,h),c(h,b),c(b,$),c(b,v),c(b,_),c(_,y),c(_,w),c(_,x),c(_,E),c(_,k),g(k,t[1]),c(b,C),c(b,A),S||(T=[m(k,"input",t[3]),m(b,"submit",t[2])],S=!0)},p(t,[n]){O===(O=N(t))&&M?M.p(t,n):(M.d(1),M=O(t),M&&(M.c(),M.m(e.parentNode,e))),2&n&&k.value!==t[1]&&g(k,t[1])},i:n,o:n,d(t){M.d(t),t&&a(e),t&&a(o),S=!1,r(T)}}}function q(t,n,e){const o=$();let r="",{person:i}=n;return t.$$set=t=>{"person"in t&&e(0,i=t.person)},[i,r,t=>{t.preventDefault(),o("email",r)},function(){r=this.value,e(1,r)}]}class z extends class{$destroy(){!function(t,n){const e=t.$$;null!==e.fragment&&(r(e.on_destroy),e.fragment&&e.fragment.d(n),e.on_destroy=e.fragment=null,e.ctx=[])}(this,1),this.$destroy=n}$on(t,n){const e=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return e.push(n),()=>{const t=e.indexOf(n);-1!==t&&e.splice(t,1)}}$set(t){var n;this.$$set&&(n=t,0!==Object.keys(n).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),M(this,t,q,L,l,{person:0})}}const P="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~".split("");var B=(t=>(n=20)=>{if(!(n>=0&&Number.isFinite(n)))throw new TypeError("Expected a `length` to be a non-negative finite number");return t(n,P)})((t,n)=>{const e=n.length,o=Math.floor(65536/e)*e-1,r=2*Math.ceil(1.1*t);let i="",l=0;for(;l<t;){const c=new Uint16Array(r);crypto.getRandomValues(c);let s=0;for(;s<r&&l<t;){const t=c[s];s+=2,t>o||(i+=n[t%e],l++)}}return i});const H="betagouv.github.io"===location.hostname?"https://app-20420772-6ed7-40ca-978c-f360edf8941c.cleverapps.io":"http://localhost:4999";console.log("API server origin:",H);var I=location.origin.includes("betagouv.github.io")?"/urbanvitaliz":"";console.log("BONJOIR ðŸ¦„ ");!function(n){const e=new z({target:document.querySelector("header .rf-shortcuts__item"),props:{}});e.$on("email",o=>{const r=o.detail,i=B();(function(n,e){return fetch(n,e).then(t)})(`${H}/login-by-email?email=${r}&secret=${i}`,{method:"POST"}).then(({person:t})=>{document.querySelector('dialog#rf-modal-login button[aria-controls="rf-modal-login"].rf-link--close').click(),e.$set({person:t}),n({person:t})}).catch(t=>console.error("error fetch email",t))})}(({person:t})=>{console.log("login succesful",t),location.assign(function(t){const{firstAccessCapability:n}=t;return`${I}/person?secret=${n}`}(t))})}();
//# sourceMappingURL=header-login.rollup.js.map
